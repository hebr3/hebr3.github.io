<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>20% Project - ProjectEuler #27</title>
    <meta name="description" content="Euler discovered the remarkable quadratic formula:  `n^2 + n + 41`...">
    <meta name="author"      content="Henry Brooks">
    <meta name="keywords"    content="Teaching Credential, 20% Project, Project Euler, Author: Henry Brooks">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/favicon.ico">
    <link rel="canonical" href="http://www.example.com/2015/04/20-project-projecteuler-27.html">
    <link rel="next" href="/2015/02/20-project-update.html">
    <link rel="prev" href="/2015/04/20-project-projecteuler-29.html">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <!-- A standard Twitter Bootstrap nav bar -->
    <header class="navbar navbar-default navbar-inverse"
            role="banner">
      <div class="container">
        <div class="navbar-header">
          <button type="button"
                  class="navbar-toggle"
                  data-toggle="collapse"
                  data-target=".our-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/index.html" class="navbar-brand">Henry Brooks</a>
        </div>
        <div class="collapse navbar-collapse our-nav-collapse"
             role="navigation">
          <ul class="nav navbar-nav">

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/index.html">All Posts</a></li>

<li><a href="/tags/20-Project.html">20% Project</a></li>

<li><a href="/tags/Assembly.html">Assembly</a></li>

<li><a href="/tags/Author-Henry-Brooks.html">Author: Henry Brooks</a></li>

<li><a href="/tags/C.html">C++</a></li>

<li><a href="/tags/Case-Study.html">Case Study</a></li>

<li><a href="/tags/CodeFights.html">CodeFights</a></li>

<li><a href="/tags/CS211.html">CS211</a></li>

<li><a href="/tags/CS231.html">CS231</a></li>

<li><a href="/tags/Cybersecurity.html">Cybersecurity</a></li>

<li><a href="/tags/Daily-Desmos.html">Daily Desmos</a></li>

<li><a href="/tags/Desmos.html">Desmos</a></li>

<li><a href="/tags/DSL.html">DSL</a></li>

<li><a href="/tags/Dynamic-Programming.html">Dynamic Programming</a></li>

<li><a href="/tags/hackerrank.html">hackerrank</a></li>

<li><a href="/tags/Haskell.html">Haskell</a></li>

<li><a href="/tags/MCS511.html">MCS511</a></li>

<li><a href="/tags/Memoization.html">Memoization</a></li>

<li><a href="/tags/MIS522.html">MIS522</a></li>

<li><a href="/tags/Project-Euler.html">Project Euler</a></li>

<li><a href="/tags/Prolog.html">Prolog</a></li>

<li><a href="/tags/Python.html">Python</a></li>

<li><a href="/tags/Racket.html">Racket</a></li>

<li><a href="/tags/Reading-Assignment.html">Reading Assignment</a></li>

<li><a href="/tags/SQL.html">SQL</a></li>

<li><a href="/tags/Teaching-Credential.html">Teaching Credential</a></li>
              </ul>
            </li>
            <li>
              <a href="/About.html">About</a>
            </li> 
            <li><a href="/feeds/all.atom.xml">Atom</a></li>
            <li><a href="/feeds/all.rss.xml">RSS</a></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">

        <!-- Main column -->
        <div id="content" class="col-md-12">





          <article>
  <header>
    <h1>20% Project - ProjectEuler #27</h1>
    <p class='date-and-tags'>
<time datetime="2015-04-11" pubdate="true">2015-04-11</time> :: <span class="tags"><a href="/tags/Teaching-Credential.html">Teaching Credential</a>, <a href="/tags/20-Project.html">20% Project</a>, <a href="/tags/Project-Euler.html">Project Euler</a></span></p>
    <p class='authors'>By: <span class="authors"><a href="/tags/Author-Henry-Brooks.html">Henry Brooks</a></span></p>
  </header>

<p>Euler discovered the remarkable quadratic formula:</p>

<p><code>n^2 + n + 41</code></p>
<!-- more-->

<p>It turns out that the formula will produce <code>40</code> primes for the consecutive values <code>n = 0</code> to <code>39</code>. However, when <code>n = 40</code>, <code>40^2 + 40 + 41 = 40(40 + 1) + 41</code> is divisible by <code>41</code>, and certainly when <code>n = 41, 41^2 + 41 + 41</code> is clearly divisible by <code>41</code>.</p>

<p>The incredible formula <code>n^2 − 79n + 1601</code> was discovered, which produces <code>80</code> primes for the consecutive values <code>n = 0</code> to <code>79</code>. The product of the coefficients, <code>−79</code> and <code>1,601</code>, is <code>−126,479</code>.</p>

<p>Considering quadratics of the form:</p>

<p><code>n^2 + an + b</code>, where <code>|a| &lt; 1,000</code> and <code>|b| &lt; 1,000</code> where <code>|n|</code> is the modulus/absolute value of <code>n</code> e.g. <code>|11| = 11</code> and <code>|−4| = 4</code></p>

<p>Find the product of the coefficients, a and b, for the quadratic expression that produces the maximum number of primes for consecutive values of n, starting with n = 0.</p>

<p><a href="https://projecteuler.net/problem=27">Project Euler</a></p>

<p>Initially I planned to tackle this problem from a strictly brute force perspective. I have found that working on a simple solution to a problem usually gives me insights to more elegant solutions.</p>

<p>Therefore I figured that the most straight forward and inelegant method was to produce a 1999 by 1999 array with individual elements of the array corresponding to the maximum number of consecutive primes generated by that combination of a and b.</p>

<p>Thus the initial element of the array in position |1,1| would be the maximum number of consecutive primes generated by n2 + (&ndash;999)n + (&ndash;999), and the final position of |1999,1999| would be n2 + (999)n + (999).</p>

<p>With this plan in mind I tried to think up a quick way to calculate the maximum number of consecutive primes for a given <strong>a</strong> and <strong>b</strong>.</p>

<p>I started by having Mathematica generate the first 101 values from the example given in the problem by using a=1 and b=41.</p>

<div class="figure"><img src="/img/ProjectEuler27a.png" alt="1" />
 <p class="caption">1</p></div>

<p>I then used <strong>PrimeQ</strong> to test whether each value was prime.</p>

<div class="figure"><img src="/img/ProjectEuler27b.png" alt="2" />
 <p class="caption">2</p></div>

<p>Then used <strong>Boole</strong> to convert these true false values to 0&rsquo;s and 1&rsquo;s.</p>

<div class="figure"><img src="/img/ProjectEuler27c.png" alt="3" />
 <p class="caption">3</p></div>

<p>And finally <strong>FirstPosition</strong> to find the first false in the list.</p>

<div class="figure"><img src="/img/ProjectEuler27d.png" alt="4" />
 <p class="caption">4</p></div>

<p>Note that the answer of 41 corresponds to the 39 primes listed in the example since this method doesn&rsquo;t count the primes from 0&ndash;39 but from 1&ndash;40 and it found a non-Prime number in position 41.</p>

<p>So&hellip;</p>

<p>This method is horribly inelegant, however it does work so it&rsquo;s time to see if I can use this method to generate the <code>1,999</code> by <code>1999</code> array I initially planned for.</p>

<p>I begin by trying my method on a smaller array and seeing if it would work at all.</p>

<div class="figure"><img src="/img/ProjectEuler27e.png" alt="5" />
 <p class="caption">5</p></div>

<p>Note that this entry should be much larger as it displays a <code>51×51</code> array of values.</p>

<p>To find the maximum element of this array I then use the <strong>Position</strong> and <strong>Max</strong> commands. <strong>Position</strong> gives the location in an array of a specified value, and <strong>Max</strong> gives the largest element of the array.</p>

<div class="figure"><img src="/img/ProjectEuler27f.png" alt="6" />
 <p class="caption">6</p></div>

<div class="figure"><img src="/img/ProjectEuler27g.png" alt="7" />
 <p class="caption">7</p></div>

<p>Since we are counting up from 0 we have now found that the Maximum number of consecutive primes is generated with <strong>a</strong>=1 and <strong>b</strong>=41 which matches the example.</p>

<p>One area of concern going forward is that it takes <code>0.655,204</code> secs for Mathematica to create the <code>51×51</code> array I used above. Since a <code>1,999×1,999</code> array is almost <code>1,600%</code> larger than a <code>50×50</code> array, that means that generating a <code>1999×1999</code> array should take at least <code>17</code> minutes and <code>28.33</code> second. Most likely longer considering that the edges of the array will be dealing with <strong>a</strong> and <strong>b</strong> values greater than <code>900</code>.</p>

<p>Still I have free time and I&rsquo;m not paying for processing time so we might as well go forward and see how long it takes.</p>

<div class="figure"><img src="/img/ProjectEuler27h.png" alt="8" />
 <p class="caption">8</p></div>

<p>So <code>21</code> minutes and <code>14</code> seconds later we have our array and can try to find the Maximum number of consecutive primes.</p>

<div class="figure"><img src="/img/ProjectEuler27i.png" alt="9" />
 <p class="caption">9</p></div>

<p>And we have a max at <code>|939,1971|</code>, so <code>939-1000=-61</code> and <code>1971-1000=971</code> are are <strong>a</strong> and <strong>b</strong> values.</p>

<p><code>a*b=-61*971=-59231</code></p>

<p>And we thus have our answer for Problem 27.</p>

<p>Now we can focus on improving this process.</p>

<p>We could start by recognizing that <strong>b</strong> has to be a prime number. It was only after I had finished this problem that I realized that since <code>n</code> starts at <code>0</code> the first element will always be <code>0*0 + a*0 + b</code>. Since there are <code>168</code> primes less than <code>1000</code> that means I only needed <code>168</code> rows instead of <code>1999</code>.</p>

<p>A <code>1999×168} array is</code>8.4%} the size of a <code>1999×1999} array and only took Mathematica</code>1} minute and <code>56} seconds to calculate.

![10](/img/ProjectEuler27j.png)

A larger time sink is that I am actually calculating out the first</code>100 n<code>values for every combination of **a** and **b** tested. Thus even if the second value calculated is non-Prime I still waste time evaluating the next 98 values.

Using the following code I can just check if the</code>n<code>values are prime and stop when a non-Prime is found.

![11](/img/ProjectEuler27k.png)

To better understand how much time this saves, I calculated a</code>50×50<code>array using the old method and the new method and had Mathematica generate an **ArrayPlot** to save space.

![12](/img/ProjectEuler27l.png)

The second method took</code>6.1%<code>of the time taken by the first method.

Using both methods together the entire process of generating the</code>1999×168<code>array takes</code>10<code>seconds.

![13](/img/ProjectEuler27m.png)

I haven't looked into it, but I suspect that I could similarly shave a couple of seconds off of the total running time by finding some trick for picking a values.

Conclusion
---

I started by creating a rather inelegant method for finding the number of consecutive primes generated on a</code>1999×1999<code>matrix. This method took</code>21<code>minutes and</code>14<code>seconds.

I next examined the problem more closely and found areas that could be refined so that I found that same solution in</code>10<code>seconds.

I'm confident that the majority of the improvement in performance came from optimizing the operation that found the number of consecutive primes.

![14](/img/ProjectEuler27n.png)

Using the above code I found that</code>280,607<code>times the second number tested was non-Prime. Since there are only</code>336,000<code>entries in the array that means that</code>83.5%` of the time while generating the original array I could have stopped after calculating the second value.</p>

<p>This was a longer write up than I originally expected, but it was a rather involved problem that benefited greatly from optimization.</p>
  <footer>
    <ul class="pager">
    <li class="previous">
      <a href="/2015/04/20-project-projecteuler-29.html">&larr; <em>20% Project - ProjectEuler #29</em></a>
    </li>
    <li class="next">
      <a href="/2015/02/20-project-update.html"><em>20% Project Update</em> &rarr;</a>
    </li>
    </ul>
  </footer>
</article>
        </div>
      </div>
      <footer>
        <hr />
        <p>Site generated
        by <a href="https://github.com/greghendershott/frog">Frog</a>,
        the <strong>fr</strong>ozen bl<strong>og</strong> tool.</p>
        <p>Using <a href="http://twitter.github.com/bootstrap/index.html">Bootstrap</a>.</p>
        <ul>
            <li><em>Copyright 2014-2017 by Henry Brooks </em>.</li>
        </ul>
      </footer>
    </div>
    <!-- </body> JS -->
    <script type="text/javascript" src="//code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  </body>
</html>